<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V.I.C.T.O.R.Y (Multi-SN)</title> 
    
    <!-- Memuat Stylesheet -->
    <link rel="stylesheet" href="style.css">
    
    <!-- Memuat Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- 
      Memuat Pustaka JavaScript (Library)
      PENTING: Menggunakan 'defer' untuk mencegah error 'Html5Qrcode is not defined'
      saat loading halaman (Race Condition Fix).
    -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.0/FileSaver.min.js" defer></script>
    
    <!-- Library QR Code Scanner -->
    <script src="https://unpkg.com/html5-qrcode" defer></script>
    
    <!-- Skrip Utama (Module) -->
    <script src="script.js" type="module" defer></script>
</head>
<body>

    <!-- BAGIAN 1: HALAMAN LOGIN -->
    <div id="login-container">
        <div class="login-box">
            <!-- Judul/Logo FiberStar -->
            <h1 class="login-title">V.I.C.T.O.R.Y</h1>
            <p class="login-subtitle">Asset Management System</p>

            <button id="google-login-btn" class="btn btn-google">
                <img src="https://upload.wikimedia.org/wikipedia/commons/c/c1/Google_%22G%22_logo.svg" alt="Google" width="18">
                Masuk dengan Google
            </button>

            <div style="margin: 20px 0; color: #aaa; font-size: 0.9rem;">atau masuk dengan email</div>

            <form id="login-form">
                <div class="form-group">
                    <label for="login-email">Email</label>
                    <input type="email" id="login-email" placeholder="email@fiberstar.co.id" required>
                </div>
                <div class="form-group">
                    <label for="login-password">Password</label>
                    <input type="password" id="login-password" placeholder="Password Anda" required>
                </div>

                <button type="submit" id="login-btn" class="btn btn-primary">Login</button>
                <button type="button" id="register-btn" class="btn btn-secondary">Daftar</button>
                <div id="login-error" style="color: red; margin-top: 10px; font-size: 0.9rem;"></div>
            </form>
        </div>
    </div>

    <!-- BAGIAN 2: APLIKASI UTAMA -->
    <div id="app-container" style="display: none;">
        
        <!-- Div Tersembunyi WAJIB untuk Library Scanner -->
        <div id="qr-reader" style="display: none;"></div>

        <!-- Header Aplikasi -->
        <header class="app-header">
            <div>
                <h1>Data Visit Site</h1>
                <p class="app-subtitle">Asset Management System</p>
            </div>
            <div style="text-align: right;">
                <span id="user-email" style="display:block; font-size: 0.85rem; color:#555; margin-bottom:5px;">User</span>
                <button id="logout-btn" style="background:none; border:none; color:red; cursor:pointer; font-weight:bold;">Logout</button>
            </div>
        </header>

        <main class="container">
            <!-- Kolom Kiri: Form Input -->
            <div class="input-form-card">
                <h2 style="margin-top:0; color:var(--fs-orange);">Form Visit Site</h2>
                <hr style="border: 0; border-top: 1px solid #eee; margin-bottom: 20px;">
                
                <form id="dataForm">
                    <div class="form-group">
                        <label for="inputTanggal">1. Tanggal</label>
                        <input type="date" id="inputTanggal" required>
                    </div>
                    <div class="form-group">
                        <label for="siteName">2. Nama Site</label>
                        <input type="text" id="siteName" required>
                    </div>
                    <div class="form-group">
                        <label for="picName">3. Nama PIC</label>
                        <input type="text" id="picName" required>
                    </div>
                    <div class="form-group">
                        <label for="noRack">4. No Rack</label>
                        <input type="text" id="noRack" list="listNoRack">
                        <datalist id="listNoRack">
                            <option value="R1"></option>
                            <option value="R2"></option>
                            <option value="R3"></option>
                            <option value="R4"></option>
                            <option value="R5"></option>
                        </datalist>
                    </div>
                    <div class="form-group">
                        <label for="namaRack">5. Nama Rack</label>
                        <input type="text" id="namaRack" list="listNamaRack">
                        <datalist id="listNamaRack"></datalist>
                    </div>
                    <div class="form-group">
                        <label for="jenisDevice">6. Jenis Device</label>
                        <input type="text" id="jenisDevice" list="listJenisDevice" required>
                        <datalist id="listJenisDevice"></datalist>
                    </div>
                    <div class="form-group">
                        <label for="modulType">7. Modul Type</label>
                        <input type="text" id="modulType" list="listModulType">
                        <datalist id="listModulType"></datalist>
                    </div>
                    <div class="form-group">
                        <label for="boardName">8. Board Name Device</label>
                        <input type="text" id="boardName" list="listBoardName">
                        <datalist id="listBoardName"></datalist>
                    </div>
                    <div class="form-group">
                        <label for="deviceMerk">9. Merk/Vendor Device</label>
                        <input type="text" id="deviceMerk" list="listDeviceMerk" required>
                        <datalist id="listDeviceMerk"></datalist>
                    </div>
                    <div class="form-group">
                        <label for="deviceStatus">10. Status Device</label>
                        <select id="deviceStatus" required>
                            <option value="Active">Active</option>
                            <option value="Not Active">Not Active</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="remark">11. Remark</label>
                        <textarea id="remark" rows="3"></textarea>
                    </div>
                </form>
            </div>

            <!-- Kolom Kanan: Upload & Hasil -->
            <div class="results-area">
                <h2 style="margin-top:0; color:var(--fs-orange);">Upload & Scan Data</h2>
                <hr style="border: 0; border-top: 1px solid #eee; margin-bottom: 20px;">

                <!-- 12. SERIAL NUMBER (MULTI-TAG) -->
                <div class="upload-section">
                    <label for="fotoUploadSN">12. Upload Foto Serial Number (SN)</label>
                    <input type="file" id="fotoUploadSN" accept="image/*">
                    <img id="imagePreviewSN" class="image-preview"/>
                    
                    <div class="button-grid">
                        <button type="button" id="btnScanSN" class="btn btn-scan">Scan File</button>
                        <button type="button" id="btnCameraSN" class="btn btn-camera">Scan Kamera</button>
                    </div>

                    <!-- WADAH CHIPS SN -->
                    <div id="snTagsContainer" class="sn-tags-container">
                        <span style="color: #aaa; font-size: 0.85rem;">Hasil scan akan muncul di sini...</span>
                    </div>
                    
                    <!-- Input Hidden untuk Data Gabungan -->
                    <input type="text" id="hasilSN" placeholder="Data SN Gabungan" readonly style="background:#f3f4f6; color:#666; margin-top:5px;">
                    <div id="ocrStatusSN" style="font-size:0.85rem; margin-top:5px;"></div>
                </div>

                <!-- 13. PART NUMBER -->
                <div class="upload-section">
                    <label for="fotoUploadPN">13. Upload Foto Part Number (PN)</label>
                    <input type="file" id="fotoUploadPN" accept="image/*">
                    <img id="imagePreviewPN" class="image-preview"/>
                    
                    <div class="button-grid">
                        <button type="button" id="btnScanPN" class="btn btn-scan">Scan File</button>
                        <button type="button" id="btnCameraPN" class="btn btn-camera">Scan Kamera</button>
                    </div>
                    
                    <input type="text" id="hasilPN" placeholder="Hasil Scan PN..." style="margin-top:10px;">
                    <div id="ocrStatusPN" style="font-size:0.85rem; margin-top:5px;"></div>
                </div>

                <!-- 14. GPS -->
                <div class="upload-section">
                    <label for="fotoUploadGPS">14. Upload Foto GPS</label>
                    <input type="file" id="fotoUploadGPS" accept="image/*">
                    <img id="imagePreviewGPS" class="image-preview"/>
                    <div id="gpsInfo" style="margin-top:5px; font-size:0.85rem; color:blue;"></div>
                </div>

                <div class="action-buttons" style="margin-top:20px;">
                    <button type="submit" form="dataForm" id="btnCreateCard" class="btn btn-primary">Simpan Data ke Database</button>
                </div>
                <div id="form-status" style="text-align:center; margin-top:10px; font-weight:bold;"></div>

                <!-- TABEL HASIL -->
                <div style="margin-top: 40px;">
                    <h3>Rekap Data Tersimpan</h3>
                    <div class="global-actions" style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:15px;">
                        <button id="btnExportExcel" class="btn btn-success" style="background:#10b981; color:white;">Export Excel</button>
                        <button id="btnDownloadImages" class="btn btn-info" style="background:#3b82f6; color:white;">Download Foto</button>
                    </div>
                    <div id="hasilDataContainer"></div>
                </div>

            </div>
        </main>
    </div>

    <!-- MODAL KAMERA -->
    <div id="camera-modal" class="camera-modal" style="display: none;">
        <div class="camera-modal-content">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                <h3 style="margin:0;">Scan QR/Barcode</h3>
                <button id="btnCloseCamera" style="background:none; border:none; font-size:1.5rem; cursor:pointer;">&times;</button>
            </div>
            <div id="qr-reader-camera"></div>
            <div style="margin-top:10px;">
                <label><input type="checkbox" id="chkContinuousScan" checked> Scan Beruntun (Continuous)</label>
            </div>
            <div id="camera-status" style="margin-top:10px; font-weight:bold; color:green;"></div>
        </div>
    </div>

</body>
</html>
