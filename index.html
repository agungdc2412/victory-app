<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V.I.C.T.O.R.Y - Asset Management v4.1</title> 
    
    <!-- CSS -->
    <link rel="stylesheet" href="style.css">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.0/FileSaver.min.js" defer></script>
    <script src="https://unpkg.com/html5-qrcode" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Main Script -->
    <script src="script.js" type="module" defer></script>
</head>
<body>

    <!-- === LOGIN SCREEN === -->
    <div id="login-container">
        <!-- BRAND FIBERSTAR -->
        <div class="login-box">
                <div class="brand-wrapper">
                    <img src="fiberstar-logo.png" alt="FiberStar Logo" class="fs-logo-header">
                </div>
            <h1 class="login-title">V.I.C.T.O.R.Y</h1>
            <p class="login-subtitle">Visual Intellegent Capture Text Optimization Report Yield</p>
            
            <button id="google-login-btn" class="btn btn-google">
                <i class="fab fa-google"></i> Masuk dengan Google
            </button>
            <div class="login-divider">atau email</div>
            <form id="login-form">
                <div class="form-group">
                    <input type="email" id="login-email" placeholder="Email Fiberstar" required>
                </div>
                <div class="form-group">
                    <input type="password" id="login-password" placeholder="Password" required>
                </div>
                <button type="submit" id="login-btn" class="btn btn-primary w-100">LOGIN</button>
            </form>
        </div>
    </div>

    <!-- === MAIN APP === -->
    <div id="app-container" style="display: none;">
        
        <!-- Sidebar Navigation -->
        <nav class="sidebar">
            <div class="sidebar-logo">
                <img src="fiberstar-logo.png" alt="FiberStar Logo" class="fiberstar-logo">
                <div class="sidebar-title">
                <span class="victory-text">VICTORY</span>
                <span id="user-display">User</span>
                </div>    
            </div>
            <ul class="nav-links">
                <li class="active" onclick="switchTab('dashboard')"><i class="fas fa-chart-pie"></i> Dashboard</li>
                <li onclick="switchTab('input')"><i class="fas fa-edit"></i> Visit Site (Form)</li>
                <li onclick="switchTab('report')"><i class="fas fa-table"></i> Report Visit</li>
                <li onclick="switchTab('reference')"><i class="fas fa-database"></i> Reference Table</li>
                <li onclick="logoutApp()" class="logout-link"><i class="fas fa-sign-out-alt"></i> Logout</li>
            </ul>
        </nav>

        <!-- Main Content Area -->
        <main class="main-content">
            
            <!-- SCANNER HIDDEN ELEMENT -->
            <div id="qr-reader" style="display: none;"></div>

            <!-- VIEW 1: DASHBOARD ANALYTICAL -->
            <section id="view-dashboard" class="view-section active">
                <div class="header-title">
                    <h1>Dashboard Analytical</h1>
                    <button class="btn btn-sm btn-secondary" onclick="refreshDashboard()"><i class="fas fa-sync"></i> Refresh</button>
                </div>
                
                <div class="dashboard-cards">
                    <div class="card-stat">
                        <h3>Total Visit</h3>
                        <p id="stat-total-visit">0</p>
                    </div>
                    <div class="card-stat">
                        <h3>Site Unik</h3>
                        <p id="stat-unique-site">0</p>
                    </div>
                    <div class="card-stat">
                        <h3>Device Active</h3>
                        <p id="stat-active-device" style="color:green;">0</p>
                    </div>
                </div>

                <div class="charts-grid">
                    <div class="chart-container">
                        <canvas id="chartStatus"></canvas>
                    </div>
                    <div class="chart-container">
                        <canvas id="chartDeviceType"></canvas>
                    </div>
                </div>
            </section>

            <!-- VIEW 2: FORM INPUT (DYNAMIC CASCADING) -->
            <section id="view-input" class="view-section">
                <div class="header-title">
                    <h1>Form Input Data Asset</h1>
                </div>

                <form id="dataForm" class="form-layout">
                    <!-- Kelompok 1: Info Site -->
                    <div class="form-card">
                        <h3><i class="fas fa-map-marker-alt"></i> Informasi Site</h3>
                        <div class="grid-2">
                            <div class="form-group">
                                <label>1. Tanggal *</label>
                                <input type="date" id="inpDate" required>
                            </div>
                            <div class="form-group">
                                <label>2. Kode Site *</label>
                                <input type="text" id="inpSiteCode" placeholder="Contoh: SUB001" required>
                            </div>
                            <div class="form-group">
                                <label>3. Nama Site *</label>
                                <input type="text" id="inpSiteName" placeholder="Nama Site Lengkap" required>
                            </div>
                            <div class="form-group">
                                <label>4. Nama PIC *</label>
                                <input type="text" id="inpPic" required>
                            </div>
                            <div class="form-group">
                                <label>5. No Rack *</label>
                                <select id="inpRackNo" required>
                                    <option value="">-- Pilih --</option>
                                    <option value="R1">R1</option>
                                    <option value="R2">R2</option>
                                    <option value="R3">R3</option>
                                    <option value="R4">R4</option>
                                    <option value="R5">R5</option>
                                    <option value="R6">R6</option>
                                    <option value="R7">R7</option>
                                    <option value="R8">R8</option>
                                    <option value="R9">R9</option>
                                    <option value="R10">R10</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>15. Floor Number</label>
                                <input type="text" id="inpFloor" value="LT.1">
                            </div>
                        </div>
                    </div>

                    <!-- Kelompok 2: Detail Device (Dynamic) -->
                    <div class="form-card">
                        <h3><i class="fas fa-server"></i> Detail Perangkat (Dynamic)</h3>
                        <div class="grid-2">
                            <div class="form-group">
                                <label>6. Module *</label>
                                <select id="inpModule" required disabled>
                                    <option value="">Loading Referensi...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>7. Device Module *</label>
                                <select id="inpDeviceModule" required disabled>
                                    <option value="">Pilih Module Dulu</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>8. Modul Type *</label>
                                <select id="inpModulType" required disabled>
                                    <option value="">Pilih Device Module Dulu</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>9. Board Name</label>
                                <select id="inpBoardName" disabled>
                                    <option value="">Pilih Modul Type Dulu</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Auto Fill Section (SESUAI HEADER CSV) -->
                        <div class="autofill-box">
                            <h4>Auto-Fill Data (SAP)</h4>
                            <div class="grid-2">
                                <div class="form-group">
                                    <label>10. Description Object (SAP)</label>
                                    <input type="text" id="autoDesc" readonly class="readonly-input">
                                </div>
                                <div class="form-group">
                                    <label>11. Type Object (SAP)</label>
                                    <input type="text" id="autoTypeObj" readonly class="readonly-input">
                                </div>
                                <div class="form-group">
                                    <label>12. Manufacturer (SAP)</label>
                                    <input type="text" id="autoManuf" readonly class="readonly-input">
                                </div>
                                <div class="form-group">
                                    <label>13. Product Type-MM (SAP)</label>
                                    <input type="text" id="autoProdType" readonly class="readonly-input">
                                </div>
                            </div>
                        </div>

                        <div class="form-group" style="margin-top:10px;">
                            <label>14. Status Device *</label>
                            <select id="inpStatus" required>
                                <option value="Active">Active</option>
                                <option value="Not Active">Not Active</option>
                                <option value="Dismantle">Dismantle</option>
                            </select>
                        </div>
                    </div>

                    <!-- Kelompok 3: Upload & Scan -->
                    <div class="form-card">
                        <h3><i class="fas fa-camera"></i> Identifikasi & Foto</h3>
                        
                        <!-- SN -->
                        <div class="upload-row">
                            <label>16. Serial Number (SN) *</label>
                            <div class="scan-wrapper">
                                <input type="file" id="fileSN" accept="image/*" class="file-input">
                                <div class="btn-group-scan">
                                    <button type="button" class="btn-icon" onclick="triggerFileScan('SN')"><i class="fas fa-file-image"></i> Scan File</button>
                                    <button type="button" class="btn-icon" onclick="openCamera('SN')"><i class="fas fa-camera"></i> Kamera</button>
                                </div>
                            </div>
                            <div id="snTagsContainer" class="chips-container"></div>
                            <input type="hidden" id="valSN">
                        </div>

                        <!-- PN -->
                        <div class="upload-row">
                            <label>17. Part Number (PN)</label>
                            <div class="scan-wrapper">
                                <input type="file" id="filePN" accept="image/*" class="file-input">
                                <div class="btn-group-scan">
                                    <button type="button" class="btn-icon" onclick="triggerFileScan('PN')"><i class="fas fa-file-image"></i> Scan File</button>
                                    <button type="button" class="btn-icon" onclick="openCamera('PN')"><i class="fas fa-camera"></i> Kamera</button>
                                </div>
                            </div>
                            <input type="text" id="valPN" placeholder="Hasil Scan PN" class="std-input">
                        </div>

                        <!-- Foto Device (3 Kolom) -->
                        <div class="upload-row">
                            <label>18. Upload Foto Device</label>
                            <div class="photo-grid-3">
                                <div>
                                    <small>Foto Label Device</small>
                                    <input type="file" id="fotoLabel" accept="image/*">
                                </div>
                                <div>
                                    <small>Foto Label Tipe</small>
                                    <input type="file" id="fotoType" accept="image/*">
                                </div>
                                <div>
                                    <small>Foto Device Jauh</small>
                                    <input type="file" id="fotoFar" accept="image/*">
                                </div>
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary btn-lg w-100">SIMPAN DATA KE DATABASE</button>
                    <div id="submitStatus" class="status-msg"></div>
                </form>
            </section>

            <!-- VIEW 3: REPORT VISIT (TABLE) -->
            <section id="view-report" class="view-section">
                <div class="header-title">
                    <h1>Report Visit</h1>
                    <div class="action-bar">
                        <button class="btn btn-success" onclick="exportExcel()"><i class="fas fa-file-excel"></i> Excel</button>
                        <button class="btn btn-primary" onclick="downloadAllImages()"><i class="fas fa-download"></i> ZIP Foto</button>
                    </div>
                </div>
                <!-- Filter & Search -->
                  <div class="report-toolbar">
                    <div class="report-search-group">
                      <label for="reportSearchInput">Search</label>
                      <input
                        type="text"
                        id="reportSearchInput"
                        placeholder="Cari Site / PIC / Module / SN / PN ..."
                      />
                    </div>
                      <div class="report-filter-group">
                          <label for="reportSearchField">Field</label>
                          <select id="reportSearchField">
                            <option value="all">Semua kolom</option>
                            <option value="siteCode">Kode Site</option>
                            <option value="siteName">Nama Site</option>
                            <option value="picName">PIC</option>
                            <option value="module">Module</option>
                            <option value="deviceModule">Device Module</option>
                            <option value="serialNumbers">Serial Number (SN)</option>
                            <option value="partNumbers">Part Number (PN)</option>
                          </select>
                        </div>
                      </div>

                <!-- Tabel hasil visit -->
                      <div class="table-wrapper">
                        <table id="reportVisitTable" class="report-table">
                          <thead>
                            <tr>
                              <th>Tanggal</th>
                              <th>Kode Site</th>
                              <th>Nama Site</th>
                              <th>PIC</th>
                              <th>Module</th>
                              <th>Device</th>
                              <th>Modul Type</th>
                              <th>Board</th>
                              <th>Status</th>
                              <th>SN</th>
                              <th>PN</th>
                              <th>Foto SN</th>
                              <th>Foto PN</th>
                              <th>Foto Device / GPS</th>
                              <th style="width:90px;">Aksi</th>
                            </tr>
                          </thead>
                          <tbody id="reportVisitTableBody">
                            <tr>
                              <td colspan="15" style="text-align:center;">Memuat data...</td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
            </section>

            <!-- VIEW 4: REFERENCE TABLE (CRUD & IMPORT) -->
            <section id="view-reference" class="view-section">
                <div class="header-title">
                    <h1>Master Data Referensi</h1>
                    <div class="action-bar">
                        <!-- Fitur Import CSV Baru -->
                        <label for="importCsvRef" class="btn btn-success" style="cursor:pointer;">
                            <i class="fas fa-file-upload"></i> Import CSV (Data Master)
                        </label>
                        <input type="file" id="importCsvRef" accept=".csv" style="display:none;">
                        
                        <button class="btn btn-primary" onclick="openRefModal()"><i class="fas fa-plus"></i> Tambah Manual</button>
                        
                        <button class="btn btn-danger" onclick="deleteAllRefs()"><i class="fas fa-trash"></i> Reset All</button>
                    </div>
                </div>
                <p class="hint-text">Import file 'Tabel Referensi.csv' di sini untuk mengisi data otomatis.</p>
                
                <!-- Status Import -->
                <div id="importStatus" style="margin-bottom:10px; font-weight:bold;"></div>

                <div class="table-responsive">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Module</th>
                                <th>Device</th>
                                <th>Type</th>
                                <th>Board</th>
                                <th>Desc (SAP)</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="refTableBody">
                            <!-- Ref Data -->
                        </tbody>
                    </table>
                </div>
            </section>

        </main>
    </div>

    <!-- MODAL KAMERA -->
    <div id="camera-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeCamera()">&times;</span>
            <h3>Scan QR Code</h3>
            <div id="qr-camera-view"></div>
            <button class="btn btn-danger w-100 mt-2" onclick="closeCamera()">Tutup</button>
        </div>
    </div>

    <!-- MODAL TAMBAH REFERENSI (MANUAL) -->
    <div id="ref-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeRefModal()">&times;</span>
            <h3>Tambah Referensi Manual</h3>
            <form id="refForm">
                <input type="hidden" id="refId">
                <div class="grid-2">
                    <div class="form-group"><label>Module</label><input type="text" id="refModule" required></div>
                    <div class="form-group"><label>Device Module</label><input type="text" id="refDevMod" required></div>
                    <div class="form-group"><label>Modul Type</label><input type="text" id="refModType" required></div>
                    <div class="form-group"><label>Board Name</label><input type="text" id="refBoard" required></div>
                    <div class="form-group"><label>Desc (SAP)</label><input type="text" id="refDesc"></div>
                    <div class="form-group"><label>Type Object (SAP)</label><input type="text" id="refTypeObj"></div>
                    <div class="form-group"><label>Manufacturer (SAP)</label><input type="text" id="refManuf"></div>
                    <div class="form-group"><label>Product Type-MM (SAP)</label><input type="text" id="refProd"></div>
                </div>
                <button type="submit" class="btn btn-primary w-100 mt-2">SIMPAN</button>
            </form>
        </div>
    </div>

</body>
</html>











