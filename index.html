<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V.I.C.T.O.R.Y</title> 
    
    <!-- Memuat Stylesheet -->
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/x-icon" href="favicon.ico"
    <!-- Memuat Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.0/FileSaver.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    
    <!-- 
      PENTING: Memuat skrip utama sebagai 'module' 
      Ini diperlukan agar kita bisa menggunakan 'import' Firebase di dalam script.js
    -->
    <script src="script.js" type="module" defer></script>
</head>
<body>

    <!-- 
      BAGIAN 1: HALAMAN LOGIN
      Secara default 'display: flex'. Akan disembunyikan oleh JavaScript jika sudah login.
    -->
    <div id="login-container">
        <div class="login-box">
    <!-- BRAND FIBERSTAR -->
    <div class="brand-wrapper">
        <!-- GANTI src dengan nama file logo kamu -->
        <img src="fiberstar-logo.png" alt="FiberStar Logo" class="fs-logo-header">
        </div>

    <h1 class="login-title">V.I.C.T.O.R.Y</h1>

    <!-- Tombol Login Google -->
    <button id="google-login-btn" class="btn btn-google">
        <img src="https://upload.wikimedia.org/wikipedia/commons/c/c1/Google_%22G%22_logo.svg" alt="Google" class="google-icon">
        Masuk dengan Google
    </button>

    <form id="login-form">
        <div class="form-group">
            <label for="login-email">Email</label>
            <input type="email" id="login-email" placeholder="email@fiberstar.co.id" required>
        </div>
        <div class="form-group">
            <label for="login-password">Password</label>
            <input type="password" id="login-password" placeholder="Password Anda" required>
        </div>

        <!-- Tombol Aksi Login/Register -->
        <div class="login-actions">
            <button type="button" id="login-btn" class="btn btn-primary">Login</button>
            <button type="button" id="register-btn" class="btn btn-secondary">Daftar Akun Baru</button>
        </div>
        <div id="login-error" class="status-text" style="color: red; text-align: center;"></div>
    </form>
</div>

    </div>

    <!-- 
      BAGIAN 2: APLIKASI UTAMA
      Secara default 'display: none'. Akan ditampilkan oleh JavaScript jika sudah login.
    -->
        <div id="app-container" style="display: none;">

  <!-- anchor untuk html5-qrcode (biarkan seperti ini) -->
  <div id="qr-reader" style="display: none;"></div>

  <div class="app-layout">
    <!-- ========== SIDEBAR ========== -->
    <aside class="sidebar">
      <div class="sidebar-logo">
        <!-- pakai nama file logo yang sudah kamu upload ke repo -->
        <img src="fiberstar-logo.png" alt="FiberStar Logo">
        <div class="sidebar-logo-text">
          <div class="app-name">V.I.C.T.O.R.Y</div>
          <div class="app-sub">FiberStar Asset Management</div>
        </div>
      </div>

      <nav class="sidebar-nav">
        <button type="button" class="sidebar-group" id="menuData">
          <span>Menu Data</span>
          <span class="chevron">â–¾</span>
        </button>
        <ul class="sidebar-group-list open">
          <li>
            <a href="#visit" data-page-target="page-visit"
               class="nav-link nav-link-active">
              Form Visit Site
            </a>
          </li>
          <li>
            <a href="#dashboard" data-page-target="page-dashboard"
               class="nav-link">
              Dashboard Admin
            </a>
          </li>
        </ul>
      </nav>
    </aside>

    <!-- ========== AREA KONTEN ========== -->
    <div class="app-main">
      <!-- TOP BAR -->
      <header class="topbar">
        <div class="topbar-left">
          <h1>Data Visit Site</h1>
          <p>Monitoring & dokumentasi aset jaringan secara real-time</p>
        </div>
        <div class="topbar-right">
          <span id="user-email" class="topbar-user">Memuat...</span>
          <button id="logout-btn" class="btn-logout">Logout</button>
        </div>
      </header>

      <!-- PAGE WRAPPER -->
      <main class="page-wrapper">
        <!-- ================= HALAMAN FORM VISIT ================= -->
        <section id="page-visit" class="app-page app-page-active">
          <div class="page-inner">
            <!-- ðŸ”¹ Pindahkan ISI FORM LAMA kamu ke sini -->
            <!-- asalnya: <div class="input-form-card"> ... </div> -->

            <div class="input-form-card">
              <h2>Form Visit Site</h2>
              <form id="dataForm">
                <!-- ====== copy persis semua form yang sekarang ====== -->
                <!-- mulai dari <div class="form-grid"> ... sampai tombol
                     â€œSimpan Data ke Databaseâ€ & status text -->
                <!-- (kode form yang kamu kirim sebelumnya, tinggal paste) -->
              </form>
            </div>
          </div>
        </section>

        <!-- ================= HALAMAN DASHBOARD ADMIN ================= -->
        <section id="page-dashboard" class="app-page">
          <div class="page-inner">
            <!-- ðŸ”¹ Pindahkan seluruh HASIL REKAP + Dashboard Admin ke sini -->
            <!-- asalnya: <div class="results-area"> ... </div> -->

            <div class="results-area">
              <!-- copy PERSIS blok hasil rekap, tombol Export, tabel,
                   dashboard admin, REST API viewer, dll yang sekarang di kanan -->
            </div>
          </div>
        </section>
      </main>
    </div>
  </div>
</div>

        <header class="app-header">
    <div class="app-header-left">
        <!-- Logo FiberStar kecil di form -->
        <img src="fiberstar-logo.png" alt="FiberStar" class="brand-logo-small">
        <div class="app-header-text">
            <h1>Data Visit Site</h1>
            <p class="app-subtitle">FiberStar â€¢ V.I.C.T.O.R.Y Asset Management</p>
        </div>
    </div>
    <div class="header-user">
        <span id="user-email">Memuat...</span>
        <button id="logout-btn" class="btn-logout">Logout</button>
    </div>
</header>


        <main class="container">
            <!-- Kolom Input Data -->
            <div class="input-form-card">
                <h2>Form Visit Site</h2>
                <form id="dataForm">
                    
                    <div class="form-grid">
                        <!-- Kolom Kiri Grid -->
                        <div class="form-column">
                            <div class="form-group">
                                <label for="inputTanggal">1. Tanggal</label>
                                <input type="date" id="inputTanggal" required>
                            </div>
                            <div class="form-group">
                                <label for="siteName">2. Nama Site</label>
                                <input type="text" id="siteName" required>
                            </div>
                            <div class="form-group">
                                <label for="picName">3. Nama PIC</label>
                                <input type="text" id="picName" required>
                            </div>
                            <div class="form-group">
                                <label for="noRack">4. No Rack</label>
                                <input type="text" id="noRack" list="listNoRack">
                                <datalist id="listNoRack">
                                    <option value="R1"></option>
                                    <option value="R2"></option>
                                    <option value="R3"></option>
                                    <option value="R4"></option>
                                    <option value="R5"></option>
                                    <option value="lainnya"></option>
                                </datalist>
                            </div>
                            <div class="form-group">
                                <label for="namaRack">5. Nama Rack</label>
                                <input type="text" id="namaRack" list="listNamaRack">
                                <datalist id="listNamaRack">
                                    <!-- Opsi akan diisi oleh JavaScript -->
                                </datalist>
                            </div>
                            <div class="form-group">
                                <label for="jenisDevice">6. Jenis Device</label>
                                <input type="text" id="jenisDevice" list="listJenisDevice" required>
                                <datalist id="listJenisDevice">
                                    <!-- Opsi akan diisi oleh JavaScript -->
                                </datalist>
                            </div>
                            <div class="form-group">
                                <label for="modulType">7. Modul Type</label>
                                <input type="text" id="modulType" list="listModulType">
                                <datalist id="listModulType">
                                    <!-- Opsi akan diisi oleh JavaScript -->
                                </datalist>
                            </div>
                            <div class="form-group">
                                <label for="boardName">8. Board Name Device</label>
                                <input type="text" id="boardName" list="listBoardName">
                                <datalist id="listBoardName">
                                    <!-- Opsi akan diisi oleh JavaScript -->
                                </datalist>
                            </div>
                            <div class="form-group">
                                <label for="deviceMerk">9. Merk/Vendor Device</label>
                                <input type="text" id="deviceMerk" list="listDeviceMerk" required>
                                <datalist id="listDeviceMerk">
                                    <!-- Opsi akan diisi oleh JavaScript -->
                                </datalist>
                            </div>
                            <div class="form-group">
                                <label for="deviceStatus">10. Status Device</label>
                                <select id="deviceStatus" required>
                                    <option value="Active">Active</option>
                                    <option value="Not Active">Not Active</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="remark">11. Remark</label>
                                <textarea id="remark" rows="3"></textarea>
                            </div>
                        </div>

                        <!-- Kolom Kanan Grid (Upload) -->
                        <div class="form-column">
                            <!-- UPLOAD FOTO SN -->
                            <div class="form-group upload-section">
                            <label for="fotoUploadSN">12. Upload Foto Serial Number (SN)</label>
                                <input type="file" id="fotoUploadSN" class="fotoUpload" accept="image/*">
                                <img id="imagePreviewSN" src="" alt="Preview SN" class="image-preview"/>
                                
                                <!-- Scan dari gambar (upload file) -->
                                <button type="button" id="btnScanSN" class="btn btn-scan">Scan QR/Barcode (File)</button>
                                
                                <!-- Scan langsung dari kamera -->
                                <button type="button" id="btnCameraSN" class="btn btn-secondary btn-camera">
                                    Scan QR/Barcode (Kamera)
                                </button>
                                
                                <!-- âœ… MULTI-SN: 1 baris = 1 serial number -->
                                <textarea id="hasilSN" rows="4" placeholder="Hasil Scan Serial Number...
                                1 baris = 1 Serial     Number"></textarea>
                                <div id="ocrStatusSN" class="status-text"></div>
                        </div>

                            <!-- UPLOAD FOTO PN -->
                            <div class="form-group upload-section">
                            <label for="fotoUploadPN">13. Upload Foto Part Number (PN)</label>
                            <input type="file" id="fotoUploadPN" class="fotoUpload" accept="image/*">
                            <img id="imagePreviewPN" src="" alt="Preview PN" class="image-preview"/>
                                
                                <!-- Scan dari gambar (upload file) -->
                                <button type="button" id="btnScanPN" class="btn btn-scan">Scan QR/Barcode (File)</button>
                                
                                <!-- Scan langsung dari kamera -->
                                <button type="button" id="btnCameraPN" class="btn btn-secondary btn-camera">
                                    Scan QR/Barcode (Kamera)
                                </button>
                                
                                <input type="text" id="hasilPN" placeholder="Hasil Scan Part Number...">
                                <div id="ocrStatusPN" class="status-text"></div>
                        </div>
                        <!-- === MODAL KAMERA UNTUK SCAN QR/BARCODE === -->
                        <div id="camera-modal" class="camera-modal" style="display: none;">
                          <div class="camera-modal-content">
                            <h3>Scan QR/Barcode via Kamera</h3>
                        
                            <!-- Pilih kamera depan/belakang -->
                            <div class="camera-controls">
                              <label for="cameraFacingSelect">Pilih kamera:</label>
                              <select id="cameraFacingSelect">
                                <option value="environment">Kamera Belakang</option>
                                <option value="user">Kamera Depan</option>
                              </select>
                            </div>
                        
                            <div id="qr-reader-camera"></div>
                        
                            <!-- Opsi extra -->
                            <div class="camera-options">
                              <label>
                                <input type="checkbox" id="chkContinuousScan" checked>
                                Continuous scan (jangan tutup setelah scan)
                              </label>
                              <label>
                                <input type="checkbox" id="chkBrightnessBoost">
                                Brightness boost (nyalakan flash jika tersedia)
                              </label>
                            </div>
                        
                            <div id="camera-status" class="status-text"></div>
                        
                            <button type="button" id="btnCloseCamera"
                                    class="btn btn-danger"
                                    style="width: 100%; margin-top: 10px;">
                              Tutup Kamera
                            </button>
                          </div>
                        </div>

                            <!-- UPLOAD FOTO GPS -->
                            <div class="form-group upload-section">
                                <label for="fotoUploadGPS">14. Upload Foto Keseluruhan (GPS Map)</label>
                                <input type="file" id="fotoUploadGPS" class="fotoUpload" accept="image/*">
                                <img id="imagePreviewGPS" src="" alt="Preview GPS" class="image-preview"/>
                                <!-- Tambahan: info GPS otomatis -->
                                <div id="gpsInfo" class="status-text" style="margin-top: 4px;"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Tombol Aksi Utama -->
                    <div class="action-buttons">
                        <button type="submit" id="btnCreateCard" class="btn btn-secondary">
                            Simpan Data ke Database
                        </button>
                    </div>
                    <div id="form-status" class="status-text" style="font-weight: bold; font-size: 1rem;"></div>
                </form>
            </div>

            <!-- Kolom Hasil (Kartu) -->
            <div class="results-area">
                <h2>Hasil Rekap Data (dari Database)</h2>
                <div class="global-actions">
                    <button id="btnExportExcel" class="btn btn-success">Export to Excel</button>
                    <button id="btnExportPDF" class="btn btn-danger">Export to PDF</button>
                    <button id="btnDownloadImages" class="btn btn-primary">Download Semua Gambar (.zip)</button>
                    <button id="btnSendEmail" class="btn btn-info">Send Email (Draft)</button>
                </div>
                <div id="globalActionStatus" class="status-text" style="font-weight: bold;"></div>
                <hr>
                <div id="hasilDataContainer">
                    <!-- Kartu-kartu data visit dari Firebase akan muncul di sini -->
                    <p>Memuat data dari database...</p>
                </div>
                <hr class="admin-divider">
                
                    <section id="admin-dashboard">
                      <h2>Dashboard Admin â€“ Rekap Aset</h2>
                    
                      <!-- Filter bar -->
                      <div class="admin-filters">
                        <div class="filter-group">
                          <label for="adminFilterSite">Site</label>
                          <input type="text" id="adminFilterSite" placeholder="Nama site / kode site">
                        </div>
                    
                        <div class="filter-group">
                          <label for="adminFilterVendor">Vendor / Merk</label>
                          <input type="text" id="adminFilterVendor" placeholder="ZTE, Huawei, dsb.">
                        </div>
                    
                        <div class="filter-group">
                          <label for="adminFilterJenis">Jenis Device</label>
                          <input type="text" id="adminFilterJenis" placeholder="OLT, Router, OTB, dll.">
                        </div>
                    
                        <div class="filter-group">
                          <label>Tanggal</label>
                          <div class="filter-date-range">
                            <input type="date" id="adminFilterDateFrom">
                            <span>s.d.</span>
                            <input type="date" id="adminFilterDateTo">
                          </div>
                        </div>
                    
                        <div class="filter-group filter-search">
                          <label for="adminSearchText">Search bebas</label>
                          <input type="text" id="adminSearchText" placeholder="Cari SN/PN/PIC/Rack...">
                        </div>
                      </div>
                    
                      <!-- Table wrapper -->
                      <div class="admin-table-wrapper">
                        <table class="admin-table">
                          <thead>
                            <tr>
                              <th>#</th>
                              <th>Tanggal</th>
                              <th>Site</th>
                              <th>PIC</th>
                              <th>Merk</th>
                              <th>Jenis Device</th>
                              <th>Rack</th>
                              <th>Serial Number (SN)</th>
                              <th>Part Number (PN)</th>
                              <th>Foto GPS</th>
                            </tr>
                          </thead>
                          <tbody id="adminTableBody">
                            <!-- Diisi via JS -->
                          </tbody>
                        </table>
                      </div>
                    
                      <!-- Pagination -->
                      <div class="admin-pagination">
                        <div>
                          Tampilkan
                          <select id="adminRowsPerPage">
                            <option value="10">10 baris</option>
                            <option value="25">25 baris</option>
                            <option value="50">50 baris</option>
                          </select>
                          per halaman
                        </div>
                        <div class="admin-pagination-controls">
                          <button type="button" id="adminPrevPage">&laquo; Sebelumnya</button>
                          <span id="adminPaginationInfo">0 data</span>
                          <button type="button" id="adminNextPage">Berikutnya &raquo;</button>
                        </div>
                      </div>
                    
                      <!-- Export & REST viewer -->
                      <div class="admin-export-bar">
                        <button type="button" id="adminExportExcel" class="btn btn-success">
                          Export (by filter) ke Excel
                        </button>
                        <button type="button" id="adminExportPDF" class="btn btn-danger">
                          Export (by filter) ke PDF
                        </button>
                      </div>
                    
                      <div class="admin-api-viewer">
                        <div>
                          <h3>REST API Viewer</h3>
                          <p>Klik salah satu baris di tabel untuk melihat payload & URL API.</p>
                          <div class="api-url">
                            <strong>REST URL:</strong>
                            <span id="adminApiUrl">â€”</span>
                          </div>
                        </div>
                        <pre id="adminApiJson" class="api-json">/* JSON dokumen akan tampil di sini */</pre>
                      </div>
                    </section>

            </div>
        </main>
        
    </div> <!-- Akhir dari #app-container -->

</body>

</html>



